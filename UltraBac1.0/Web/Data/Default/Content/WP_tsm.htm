<h2>New Design Model for the UltraBac Version 8.2.2 TSM Device</h2>
<p><a title="White Paper" href="~/data/default/content/0805_TSMDevice.pdf">PDF Version</a></p>
<p><strong>INTRODUCTION</strong></p>
<p align=left><img style="WIDTH: 262px; HEIGHT: 300px" height=300 alt="Figure 1 - UltraBac TSM Device Properties" src="~/data/default/images/catalog/original/whitepapers/TSM%20Device/0805_TSMDevice1.jpg" width=262 border=0><br /><strong><font size=1>Figure 1:</font></strong><font size=1> UltraBac TSM Device Properties.</font></p>
<p>New options are available in UltraBac as shown in the dialog box above. They are described in detail here:</p>
<ol>
<li>Port. Unique port numbers can now be specified in the UI instead of having to place the information in the DSM.OPT file. This is especially helpful when booting from the UBDR Gold Restore CD or USB key.</li>
<li>Edit button for DSM.OPT. It is possible the DSM.OPT file will be used less now that the user interface includes the port number. However, an edit button has also been added so that UltraBac can easily open DSM.OPT in Notepad. This is especially helpful when booting off the UBDR Gold Restore CD. The edit button does not work if you are connected to a remote machine using the "Connect To:" feature. This button will always bring up the DSM.OPT file of the local machine.</li>
<li>Active/Inactive Files. Backups may be selected from inactive backup sessions for restore and will be explained further in this document.</li>
<li>Erase All Data. Pressing this button will result in every object that resides in the NODE\FILESPACE being deleted. A warning will be presented before the data is actually deleted. While this option is useful in testing, please use very selectively! It is essentially equivalent to deleting a filespace in TSM Administrator. NOTE: TSM Device users must have "backdel=yes" access to use this feature.</li></ol>
<p align=left><img style="WIDTH: 324px; HEIGHT: 200px" height=200 alt="Figure 2 - Erase All Data Confirmation" src="~/data/default/images/catalog/original/whitepapers/TSM%20Device/0805_TSMDevice2.jpg" width=324 border=0><br /><strong><font size=1>Figure 2:</font></strong><font size=1> Erase All Data Confirmation.</font></p>
<p><strong>LEGACY COMPATIBILITY</strong> </p>
<p></p>
<p>In prior versions of the TSM Device, it was possible to use archive mode or backup mode. In the new version, backups are restricted to backup mode only. However, if previous backups were performed in archive mode, these backups can still be restored. The backup/archive and folder options are still available but, by design, are hidden by default. These options are hidden, primarily, so they can be avoided going forward. Under "Tools"/"Options"/"Devices" there is a new dialog in the UI in which the archive mode can be enabled. It is still possible to back up using Archive Mode if this option is selected but, due to various limitations, this is NOT recommended.</p>
<p align=left><img style="WIDTH: 359px; HEIGHT: 150px" height=150 alt="Figure 3 - Tivoli Device Options" src="~/data/default/images/catalog/original/whitepapers/TSM%20Device/0805_TSMDevice3.jpg" width=359 border=0><br /><strong><font size=1>Figure 3:</font></strong><font size=1> Tivoli Device Options.</font></p>
<p>Once "Enable the Archive Mode checkbox in the Tivoli Device Properties dialog" has been checked, click "OK," and a slightly different dialog box nder "Select"/"Storage Devices"/"Tivoli Tab"/"Add New" becomes available. Here a new TSM device pointing to the same NODE\FILESPACE has been created with the Archive Mode checked. It is suggested that a separate TSM device for legacy restores be created to avoid accidentally leaving the Archive box checked and subsequent backups being processed in the wrong (archive) mode. The creation of a separate TSM device can be created with a script, or it can be created manually if or when it's needed for restore. Also, note in Figure 4 below that "Folder" now shows up. So, if a user previously backed up using a folder option, it can be enabled for restore purposes as well.</p>
<p align=left><img style="WIDTH: 306px; HEIGHT: 350px" height=350 alt="Figure 4 - UltraBac TSM Device Properties with Folder Field" src="~/data/default/images/catalog/original/whitepapers/TSM%20Device/0805_TSMDevice4.jpg" width=306 border=0><br /><strong><font size=1>Figure 4:</font></strong><font size=1> UltraBac TSM Device Properties with Folder Field.</font></p>
<p><strong>EXPLAINING ACTIVE AND INACTIVE BACKUPS</strong></p>
<p>To help explain active and inactive backups, consider each backup in TSM to be a backup to a pseudo tape. This is a stand-alone tape drive and the active backup is the tape in the drive. In this case, the tape cannot be ejected but it can be overwritten, appended, etc. The active tape that is in the drive can be cleared, but then the TSM Device has essentially copied that tape "magically" to another inactive tape. Many backups can be performed to the same active backup or tape by simply not clearing the media. So, if a full backup is conducted on the first day of the month, and incremental backups for the rest of the month, this can be easily done by clearing/erasing the media when a full backup takes place. If 120 days worth of backups (or 4 months worth) is required, it might make more sense to configure the TSM Device to save four versions of backups and to clear the media once a month during the full backup. Using this method, all of the incremental backups reside on the same media as the full backups, and only those incremental backups that belong to the full backup are included. When media on the full backup is cleared, those backups are not actually deleted â€“ they just become an inactive backup. Since there would be four versions of backups, the oldest month's backups would be erased.</p>
<p><strong>HOW DO I RESTORE ACTIVE AND INACTIVE BACKUPS?</strong></p>
<p>By default, when a restore is performed, only the indexes of the active backup will show for that restore. If a restore from a two month old inactive backup needs to be performed, a few configuration changes will need to be made to the TSM Device. The following explains how to view a particular set of inactive backups:</p>
<ol>
<li>Go into the TSM Device and click "Use Inactive files for Restores," then click on "Select Inactive Version." When this is completed the dialog box should be similar to Figure 5. 
<p align=left><img style="WIDTH: 297px; HEIGHT: 300px" height=300 alt="Figure 5 - Viewing Inactive Backups" src="~/data/default/images/catalog/original/whitepapers/TSM%20Device/0805_TSMDevice5.jpg" width=297 border=0><br /><strong><font size=1>Figure 5:</font></strong><font size=1> Viewing Inactive Backups.</font></p>The dialog box above shows only the date and time the media was prepared, cleared, or erased. This is because the TSM Device code only recognizes limited information. In order to show the type of backup and description, UltraBac would need to read into the device and its actual files, thus making the process much less efficient. By only displaying the date and time of when the media is prepared, there should be enough information to recognize the appropriate backups in a much more efficient manner. Click on "View Sets contained in this group" to see the date and time that each backup was added to TSM. This can be useful to determine if a backup was skipped on a particular day, how many backups were done, etc. However, further details than date and time are not provided.</li>
<p align=left><img style="WIDTH: 349px; HEIGHT: 300px" height=300 alt="Figure 6 - Set Viewer" src="~/data/default/images/catalog/original/whitepapers/TSM%20Device/0805_TSMDevice6.jpg" width=349 border=0><br /><strong><font size=1>Figure 6:</font></strong><font size=1> Set Viewer.</font></p>
<li>Highlight the version of the backup to restore and click "OK."</li>
<li>Click on the Restore wizard, and select "From Storage Media." Do not choose "Online Indexes" because this section will only contain the most recent or active backup to a particular device and it will not be possible to complete a restore from an inactive backup. Once a user clears the media, the index to that deleted backup (which is actually not deleted but instead marked inactive) is also deleted. This essentially means that online indexes do not contain indexes of inactive backups.</li></ol>
<p><strong>NOTE:</strong> If Express Indexes are enabled, "Restore Wizard/Retrieve from Storage Media" will show the Express Index for the most recent or active backups. The "Express Index" checkbox must be unchecked or the indexes displayed may be the wrong indexes. Additionally, if that index is loaded and a restore is tried, the "Unable to position correctly to file" error will most likely appear and the restore will fail. If only backing up to the TSM Device on that computer, it is highly recommended that the Express Indexes are turned off altogether to prevent unnecessary confusion.</p>
<p align=left><img style="WIDTH: 364px; HEIGHT: 300px" height=300 alt="Figure 7 - Index Options" src="~/data/default/images/catalog/original/whitepapers/TSM%20Device/0805_TSMDevice7.jpg" width=364 border=0><br /><strong><font size=1>Figure 7:</font></strong><font size=1> Index Options.</font></p>
<p>The dialog box above shows the location of the option to disable Express Indexes entirely. This dialog is available under "Tools"/"Options"/"General"/"Index" tab. Below is a dialog box displaying the backup indexes. This image shows that when the Express Index option above is disabled, the "Use Express Index" checkbox below is grayed out.</p>
<p align=left><img style="WIDTH: 363px; HEIGHT: 250px" height=250 alt="Figure 8 - Select Index" src="~/data/default/images/catalog/original/whitepapers/TSM%20Device/0805_TSMDevice8.jpg" width=363 border=0><br /><strong><font size=1>Figure 8:</font></strong><font size=1> Select Index.</font></p>
<p><strong>OTHER BEST PRACTICES</strong></p>
<p>Several examples have been provided with regard to when to clear media and how to restore inactive data, including the Express Index. Another suggestion for a best practice when using the TSM Device is to create a NODENAME for each computer. In addition, create a filespace for each type of backup that is performed. For example, if a user wants to create a really large, one time backup, it is recommended that this backup is not placed in the same filespace as those of smaller backups. This occurs because UltraBac doesn't write files directly into the TSM Device; instead, it creates 512 MB chunks.</p>
<p>As an example, one big 100 GB backup is created and, each time after that, a full backup of 15 GB is created. The _ub_back.001 through _ub_back.005 files will get rotated through on a normal schedule. However, the .356 file that was created as part of the 100 GB backup will never get erased because another backup that large will not be performed again. If the user puts the 100 GB backup in a separate filespace, then it can easily be deleted when it is no longer needed.</p>
<p>Another example would be a save of four versions of file backups and 10 versions of image backups. In this case, consider creating two NODES, each with separate retention policies, such as COMPUTERNAME_FILE and COMPUTERNAME_IMAGE.</p>
<p>If the same NODENAME and filespace were targeted with different types of backups, the media may expire prematurely and create issues. For example: If image backups run and clear the media each time, and incremental file backups run the next night, these will become part of the active backup. The problem occurs because the active backup also happens to be the image backup. It is important to keep the different types of backups separate to avoid confusion.</p>
<p>Finally, consider a TSM admin query showing three backup versions. In the screenshot below, one backup is active and the rest are inactive. This query can be appended to the end with an "AND NODE_NAME = 'COMPUTER' AND FILESPACE_NAME = 'FILESPACE'" to limit the amount of data returned.</p>
<p align=left><img id="admin-query" style="WIDTH: 650px; HEIGHT: 138px" height=138 alt="Figure 9 - TSM Admin Query with Three Backup Versions" src="~/data/default/images/catalog/original/whitepapers/TSM%20Device/0805_TSMDevice9.jpg" width=650 border=0><br /><strong><font size=1>Figure 9:</font></strong><font size=1> TSM Admin Query with Three Backup Versions.</font></p>
<p><em>&#169; Copyright 2008 UltraBac Software. All rights reserved.<br />UltraBac Software believes the information in this publication is accurate as of its publication date. The information is subject to change without notice.<br />UltraBac Software, UltraBac, UBDR Pro, UBDR Gold, UltraBac Software logo, and Backup and Disaster Recovery for Business are trademarks of UltraBac Software. Other product names mentioned herein may be trademarked and are property of their respective companies.</em></p>
